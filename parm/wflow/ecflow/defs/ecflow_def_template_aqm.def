extrn /totality_limit:TOTALITY

suite {{ envir }}_{{ net }}
  inlimit /totality_limit:TOTALITY
  family {{ net }}
    edit PACKAGEHOME '{{ homedir  }}'
    edit NET '{{ net }}'
    edit model_ver '{{ model_ver }}'
    edit RUN '{{ run }}'
    edit PROJ '{{ net | upper }}'
    edit PROJENVIR 'DEV'
    edit MACHINE_SITE 'development'
    edit ENVIR '{{ envir  }}'
    edit QUEUE '{{ queue_default }}'
    edit QUEUE_ARCH '{{ queue_hpss }}'
    edit OUTPUTDIR '{{ logbasedir }}'
    edit ECF_FILES '{{ homedir }}/ecf/scripts'
    family {{ model_ver }}
{%- for icyc in cycles_1d %}
      family {{ icyc }}
        edit CYC '{{ icyc }}'
  {%- for itsk_grp in task_group.keys() %}
        family {{ itsk_grp }}
    {%- for itsk in task_group[itsk_grp] %}
      {%- if itsk == 'nexus_emission' %}
        {%- for inspt in nspt_list %}
          task j{{ itsk }}_{{ inspt }}
            edit NSPT {{ inspt }}
            trigger ./jnexus_gfs_sfc==complete
        {%- endfor %}
      {%- elif itsk == 'run_ens_post' %}
        {%- if icyc == '06' or icyc == '12' %}
          {%- for ifct in fcst_len_max_list %}
          task j{{ itsk }}_f{{ ifct }}
            trigger ../coldstart/jrun_fcst==complete 
          {%- endfor %}
        {%- else %}
          {%- for ifct in fcst_len_min_list %}
          task j{{ itsk }}_f{{ ifct }}
            trigger ../coldstart/jrun_fcst==complete
          {%- endfor %}
        {%- endif %}
      {%- else %}
          task j{{ itsk }}
        {%- if itsk == 'make_orog' %}
            trigger ./jmake_grid==complete
        {%- elif itsk == 'make_sfc_climo' %}
            trigger ./jmake_orog==complete
        {%- elif itsk == 'make_ics' %}
            trigger ./jget_extrn_ics==complete
        {%- elif itsk == 'make_lbcs' %}
            trigger ./jget_extrn_lbcs==complete
        {%- elif itsk == 'run_fcst' %}
            trigger ../aqm_prep==complete and ./jmake_ics==complete and ./jmake_lbcs==complete
        {%- elif itsk == 'nexus_post_split' %}
            trigger ./jnexus_emission_{{ num_split_nexus_m1 }}
        {%- elif itsk == 'fire_emission' or itsk == 'point_source' or itsk == 'make_grid' or itsk == 'get_extrn_ics' or itsk == 'get_extrn_lbcs' %}
            trigger ./jnexus_gfs_sfc==active or ./jnexus_gfs_sfc==complete
        {%- elif itsk == 'aqm_ics' %}
            trigger ../coldstart/jmake_ics==complete
        {%- elif itsk == 'aqm_lbcs' %}
            trigger ../coldstart/jmake_lbcs==complete
        {%- elif itsk == 'pre_post_stat' %}
            trigger ../coldstart/jrun_fcst==complete
        {%- elif itsk == 'post_stat_o3' or itsk == 'post_stat_pm25' or itsk == 'bias_correction_o3' or itsk == 'bias_correction_pm25' %}
            trigger ./jpre_post_stat==complete
        {%- endif %}
      {%- endif %}
    {%- endfor %}
        endfamily # task_group
  {%- endfor %}
        family ecf_manager
          task jecflow_manager
            trigger ../nexus/jnexus_gfs_sfc==active or ../nexus/jnexus_gfs_sfc==complete
            event 1 release_next_cycle
            event 2 requeue_cycle      
      endfamily # cyc
{%- endfor %}
    endfamily # model_ver
  endfamily  # NET
endsuite
